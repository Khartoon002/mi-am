<!DOCTYPE html>
<html lang="en" id="kubio">
<head>
  <!-- Core -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="format-detection" content="telephone=no,email=no,address=no" />

  <!-- Indexing & Canonical -->
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <link rel="canonical" href="https://miamorweb.site/blog.html" />

  <!-- Title & Description -->
  <title>MiAmor Blog — Guides, Updates & Safety Tips (Nigeria)</title>
  <meta name="title" content="MiAmor Blog — Guides, Updates & Safety Tips (Nigeria)" />
  <meta name="description" content="Official MiAmor blog. Read setup guides, feature updates, marketplace tips, and safety best practices for users in Nigeria and beyond." />

  <!-- Brand / PWA -->
  <meta name="theme-color" content="#0b64d8" />
  <link rel="apple-touch-icon" sizes="180x180" href="/img/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/icons/favicon-32x32.png">
  <link rel="manifest" href="/manifest.webmanifest" />

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://miamorweb.site/blog.html" />
  <meta property="og:site_name" content="MiAmor" />
  <meta property="og:locale" content="en_NG" />
  <meta property="og:title" content="MiAmor Blog — Guides, Updates & Safety Tips" />
  <meta property="og:description" content="Setup guides, feature updates, marketplace tips, and safety best practices." />
  <meta property="og:image" content="https://miamorweb.site/img/og-cover.jpg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="MiAmor Blog — Guides, Updates & Safety Tips" />
  <meta name="twitter:description" content="Official MiAmor blog for Nigeria & beyond." />
  <meta name="twitter:image" content="https://miamorweb.site/img/og-cover.jpg" />

  <!-- Fonts (fast) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/styles.css">

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"MiAmor Blog",
    "url":"https://miamorweb.site/blog.html",
    "description":"Official MiAmor blog with guides, updates and safety tips.",
    "inLanguage":"en-NG"
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://miamorweb.site/"},
      {"@type":"ListItem","position":2,"name":"Blog","item":"https://miamorweb.site/blog.html"}
    ]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Blog",
    "name":"MiAmor Blog",
    "url":"https://miamorweb.site/blog.html",
    "description":"Guides, updates, marketplace and safety content from MiAmor."
  }
  </script>

  <!-- Styles (kept) -->
  <style>
    :root{--brand:#0b64d8;--brand-dark:#084ca6;--text:#0f172a;--muted:#475569;--bg:#f8fafc}
    html{scroll-behavior:smooth}
    body{margin:0;font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:var(--bg)}

    /* Header */
    .hero{background:linear-gradient(180deg,rgba(11,100,216,.15),rgba(11,100,216,.05))}
    .hero .wrap{max-width:1120px;margin:0 auto;padding:2rem 1rem;text-align:center}
    .hero h1{font-family:'Montserrat',sans-serif;margin:.25rem 0 .5rem}
    .hero p{margin:0 auto 1rem;max-width:760px;color:var(--muted)}

    /* Search + filter */
    .controls{max-width:1120px;margin:0 auto;padding:1rem;display:grid;grid-template-columns:1fr 240px;gap:.75rem}
    @media (max-width:800px){.controls{grid-template-columns:1fr}}
    .search{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:.6rem .8rem}
    .search input{width:100%;border:0;outline:0;font-size:1rem}
    .select{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:.6rem .8rem}

    /* Grid */
    .wrap{max-width:1120px;margin:0 auto;padding:1rem}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1rem}
    .card{background:#fff;border-radius:16px;box-shadow:0 5px 16px rgba(2,6,23,.08);padding:1.1rem;display:flex;flex-direction:column}
    .card img{width:100%;height:auto;border-radius:12px}
    .card h2{font-size:1.05rem;margin:.6rem 0 .25rem}
    .meta{font-size:.9rem;color:#64748b;margin-bottom:.35rem}
    .excerpt{color:#0f172a;opacity:.92}
    .card a.btn{margin-top:auto;align-self:flex-start}

    /* Buttons */
    .btn{background:var(--brand);color:#fff;padding:.6rem .9rem;border-radius:999px;text-decoration:none;font-weight:700;display:inline-block}
    .btn:hover{background:var(--brand-dark)}

    /* Footer */
    .footer{background:#0a1024;color:#cbd5e1;margin-top:1rem}
    .footer .wrap{max-width:1120px;margin:0 auto;padding:2.25rem 1rem}
    .copyright{opacity:.8;font-size:.9rem;margin-top:1rem}
  </style>
</head>
<body>
  <!-- NAV (kept) -->
  <div class="nav-wrap" id="top">
    <nav class="nav" aria-label="Primary">
      <a class="brand" href="/" aria-label="MiAmor Home">
        <img src="/img/miamor-logo.png" alt="MiAmor logo" width="36" height="36" loading="eager" decoding="async">
        <span>MiAmor</span>
      </a>
      <ul class="nav-menu">
        <li><a href="/" rel="follow">Home</a></li>
        <li><a href="/downloads.html" rel="follow">Download</a></li>
        <li><a href="/faq.html" rel="follow">FAQ</a></li>
        <li><a class="cta" href="/register.html" rel="follow">Register</a></li>
      </ul>
    </nav>
  </div>

  <!-- Header (kept) -->
  <header class="hero">
    <div class="wrap">
      <h1>MiAmor Blog</h1>
      <p>Setup guides, feature updates, marketplace tips, and safety best practices for Nigeria & beyond.</p>
    </div>
  </header>

  <!-- Search + filter (kept) -->
  <section class="controls" aria-label="Blog search and filter">
    <div class="search">
      <label for="q" class="sr-only" style="position:absolute;left:-9999px">Search posts</label>
      <input id="q" type="search" placeholder="Search posts…" aria-label="Search posts">
    </div>
    <select id="category" class="select" aria-label="Filter by category">
      <option value="">All categories</option>
      <option value="guides">Guides</option>
      <option value="updates">Updates</option>
      <option value="marketplace">Marketplace</option>
      <option value="safety">Safety</option>
    </select>
  </section>

  <!-- Dynamic Blog grid -->
  <main class="wrap" role="main">
    <section class="grid" id="posts" aria-live="polite" aria-busy="true">
      <!-- Cards will be injected here -->
    </section>
  </main>

  <!-- Footer (kept) -->
  <footer class="footer" role="contentinfo">
    <div class="wrap">
      <nav aria-label="Footer">
        <a href="/">Home</a> •
        <a href="/downloads.html">Download</a> •
        <a href="/packages.html">Packages</a> •
        <a href="/faq.html">FAQ</a> •
        <a href="/contact.html">Contact</a>
      </nav>
      <p class="copyright">© MiAmor 2025 • All rights reserved</p>
    </div>
  </footer>

  <!-- Fetch posts + filter + schema -->
<script>
  // ---- Config: Feed URL ----
  const FEED_URL = "https://script.google.com/macros/s/AKfycbwc95nVfbQkuRxPtZ24qCvwnGprw75FKMmCogKMOtgNv2WkvqLAKai5xfzpQE36If9X/exec";

  // ---- DOM refs ----
  const postsEl = document.getElementById('posts');
  const q = document.getElementById('q');
  const cat = document.getElementById('category');

  // ---- Helpers ----
  const escapeHTML = (str='') =>
    String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

  const fmtDate = (d) => {
    try { return new Date(d).toLocaleDateString(); }
    catch { return new Date().toLocaleDateString(); }
  };

  const slugify = (s='') =>
    String(s).toLowerCase()
      .trim()
      .replace(/['"’]/g,'')
      .replace(/[^a-z0-9]+/g,'-')
      .replace(/^-+|-+$/g,'');

  // Convert Sheets HYPERLINK() and plain URLs into safe <a> tags
  function linkify(text='') {
    // =HYPERLINK("url","text")
    let out = String(text).replace(/=HYPERLINK\(\s*"([^"]+)"\s*,\s*"([^"]+)"\s*\)/gi, (_, url, label) => {
      const u = escapeHTML(url);
      const l = escapeHTML(label);
      return '<a href="'+u+'" target="_blank" rel="noopener nofollow">'+l+'</a>';
    });

    // Raw URLs
    out = out.replace(/((https?:\/\/)[^\s<>"')]+)(?![^<]*>)/gi, (m) => {
      const u = escapeHTML(m);
      return '<a href="'+u+'" target="_blank" rel="noopener nofollow">'+u+'</a>';
    });

    return out;
  }

  // Parse plain text into paragraphs and lists while staying safe
  function formatBody(raw='') {
    if (!raw) return '';

    // Normalize newlines
    const txt = String(raw).replace(/\r\n?|\r/g, '\n');

    // Split into blocks by blank lines
    const blocks = txt.split(/\n{2,}/);

    const parts = blocks.map(block => {
      const lines = block.split(/\n/).map(l => l.trim()).filter(Boolean);

      // List block if all lines start with -, •, or *
      const isList = lines.length && lines.every(l => /^[\-•*]\s+/.test(l));
      if (isList) {
        const items = lines
          .map(l => l.replace(/^[\-•*]\s+/, ''))
          .map(item => '<li>'+linkify(escapeHTML(item))+'</li>')
          .join('');
        return '<ul>'+items+'</ul>';
      }

      // Normal paragraph (join single-line breaks back with spaces)
      const para = lines.join(' ');
      return '<p>'+linkify(escapeHTML(para))+'</p>';
    });

    return parts.join('');
  }

  // Create a short excerpt from raw content if description is missing
  function makeExcerpt(raw='') {
    if (!raw) return '';
    const firstBlock = String(raw).replace(/\r\n?|\r/g,'\n').split(/\n{2,}/)[0] || raw;
    const clean = firstBlock
      .replace(/=HYPERLINK\([^)]*\)/gi, '') // drop formula text
      .replace(/https?:\/\/\S+/g, '')       // drop bare urls
      .trim();
    return clean.length > 180 ? clean.slice(0, 177) + '...' : clean;
  }

 function buildCard(post) {
  const title = escapeHTML(post.title || 'MiAmor Blog');
  const desc  = escapeHTML(post.description || '');
  const img   = escapeHTML(post.image || '/img/og-cover.jpg');
  const bodyRaw  = post.content || '';
  const category = (post.category || '').toLowerCase().trim();

  // Formatted HTML body (safe + paragraphs/lists/links)
  const bodyHTML = formatBody(bodyRaw);

  // If no explicit description, auto-excerpt
  const excerptText = desc || makeExcerpt(bodyRaw);

  return `
    <article class="card" ${category ? `data-cat="${escapeHTML(category)}"` : ''}>
      <img src="${img}" alt="${title}" loading="lazy" decoding="async">
      <h2>${title}</h2>
      <div class="meta">${fmtDate(post.publishedAt || Date.now())}${category ? ` • ${escapeHTML(category)}` : ''}</div>
      ${excerptText ? `<p class="excerpt">${excerptText}</p>` : ''}
      ${bodyHTML ? `<div class="excerpt">${bodyHTML}</div>` : ''}
    </article>
  `;
}

  function injectSchema(posts) {
    const graph = posts.map(p => {
      const publishedISO = new Date(p.publishedAt || Date.now()).toISOString();
      const slug = p.slug || slugify(p.title || 'post');
      return {
        "@type": "BlogPosting",
        "headline": p.title,
        "description": p.description || makeExcerpt(p.content || ''),
        "image": p.image || "https://miamorweb.site/img/miamor-logo.png",
        "articleBody": (p.content || '').replace(/=HYPERLINK\([^)]*\)/gi, ''), // plain text for schema
        "author": {"@type":"Organization","name":"MiAmor"},
        "publisher": {"@type":"Organization","name":"MiAmor","logo":{"@type":"ImageObject","url":"https://miamorweb.site/img/miamor-logo.png"}},
        "mainEntityOfPage":{"@type":"WebPage","@id": "https://miamorweb.site/blog-post.html?slug=" + slug},
        "datePublished": publishedISO,
        "dateModified": publishedISO
      };
    });
    const script = document.createElement('script');
    script.type = 'application/ld+json';
    script.textContent = JSON.stringify({"@context":"https://schema.org","@graph":graph});
    document.head.appendChild(script);
  }

  function render(posts) {
    postsEl.innerHTML = posts.map(buildCard).join('');
    postsEl.setAttribute('aria-busy','false');
    // refresh filter after render
    filter();
  }

  // ---- Fetch and render ----
  fetch(FEED_URL)
    .then(r => r.json())
    .then(posts => {
      if (!Array.isArray(posts)) throw new Error('Invalid feed format');
      render(posts);
      injectSchema(posts);
    })
    .catch(err => {
      console.error(err);
      postsEl.setAttribute('aria-busy','false');
      postsEl.innerHTML = "<p style='color:#b91c1c;background:#fee2e2;padding:.75rem;border-radius:.5rem'>Error loading blog posts.</p>";
    });

  // ---- Filter (search + category) ----
  function filter() {
    const term = (q.value || '').toLowerCase();
    const c = (cat.value || '').toLowerCase();
    const cards = postsEl.querySelectorAll('.card');
    cards.forEach(card => {
      const matchesTerm = card.textContent.toLowerCase().includes(term);
      const matchesCat = !c || (card.getAttribute('data-cat') === c);
      card.style.display = (matchesTerm && matchesCat) ? '' : 'none';
    });
  }
  q.addEventListener('input', filter);
  cat.addEventListener('change', filter);

  // Optional: service worker
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js').catch(()=>{});
    });
  }
</script>
</body>
</html>
