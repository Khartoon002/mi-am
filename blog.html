<!DOCTYPE html> 
<html lang="en" id="kubio">
<head>
  <!-- Core -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="format-detection" content="telephone=no,email=no,address=no" />

  <!-- Indexing & Canonical -->
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <link rel="canonical" href="https://miamorweb.site/blog.html" />

  <!-- Title & Description -->
  <title>MiAmor Blog — Guides, Updates & Safety Tips (Nigeria)</title>
  <meta name="title" content="MiAmor Blog — Guides, Updates & Safety Tips (Nigeria)" />
  <meta name="description" content="Official MiAmor blog. Read setup guides, feature updates, marketplace tips, and safety best practices for users in Nigeria and beyond." />

  <!-- Brand / PWA -->
  <meta name="theme-color" content="#0b64d8" />
  <link rel="apple-touch-icon" sizes="180x180" href="/img/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/icons/favicon-32x32.png">
  <link rel="manifest" href="/manifest.webmanifest" />

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://miamorweb.site/blog.html" />
  <meta property="og:site_name" content="MiAmor" />
  <meta property="og:locale" content="en_NG" />
  <meta property="og:title" content="MiAmor Blog — Guides, Updates & Safety Tips" />
  <meta property="og:description" content="Setup guides, feature updates, marketplace tips, and safety best practices." />
  <meta property="og:image" content="https://miamorweb.site/img/og-cover.jpg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="MiAmor Blog — Guides, Updates & Safety Tips" />
  <meta name="twitter:description" content="Official MiAmor blog for Nigeria & beyond." />
  <meta name="twitter:image" content="https://miamorweb.site/img/og-cover.jpg" />

  <!-- Fonts (fast) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/styles.css">

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"MiAmor Blog",
    "url":"https://miamorweb.site/blog.html",
    "description":"Official MiAmor blog with guides, updates and safety tips.",
    "inLanguage":"en-NG"
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://miamorweb.site/"},
      {"@type":"ListItem","position":2,"name":"Blog","item":"https://miamorweb.site/blog.html"}
    ]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Blog",
    "name":"MiAmor Blog",
    "url":"https://miamorweb.site/blog.html",
    "description":"Guides, updates, marketplace and safety content from MiAmor."
  }
  </script>

  <!-- Styles (kept) -->
  <style>
    :root{--brand:#0b64d8;--brand-dark:#084ca6;--text:#0f172a;--muted:#475569;--bg:#f8fafc}
    html{scroll-behavior:smooth}
    body{margin:0;font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:var(--bg)}

    /* Header */
    .hero{background:linear-gradient(180deg,rgba(11,100,216,.15),rgba(11,100,216,.05))}
    .hero .wrap{max-width:1120px;margin:0 auto;padding:2rem 1rem;text-align:center}
    .hero h1{font-family:'Montserrat',sans-serif;margin:.25rem 0 .5rem}
    .hero p{margin:0 auto 1rem;max-width:760px;color:var(--muted)}

    /* Search + filter */
    .controls{max-width:1120px;margin:0 auto;padding:1rem;display:grid;grid-template-columns:1fr 240px;gap:.75rem}
    @media (max-width:800px){.controls{grid-template-columns:1fr}}
    .search{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:.6rem .8rem}
    .search input{width:100%;border:0;outline:0;font-size:1rem}
    .select{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:.6rem .8rem}

    /* Grid */
    .wrap{max-width:1120px;margin:0 auto;padding:1rem}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1rem}
    .card{background:#fff;border-radius:16px;box-shadow:0 5px 16px rgba(2,6,23,.08);padding:1.1rem;display:flex;flex-direction:column}
    .card img{width:100%;height:auto;border-radius:12px}
    .card h2{font-size:1.05rem;margin:.6rem 0 .25rem}
    .meta{font-size:.9rem;color:#64748b;margin-bottom:.35rem}
    .excerpt{color:#0f172a;opacity:.92}
    .card a.btn{margin-top:auto;align-self:flex-start}

    /* Buttons */
    .btn{background:var(--brand);color:#fff;padding:.6rem .9rem;border-radius:999px;text-decoration:none;font-weight:700;display:inline-block}
    .btn:hover{background:var(--brand-dark)}

    /* Footer */
    .footer{background:#0a1024;color:#cbd5e1;margin-top:1rem}
    .footer .wrap{max-width:1120px;margin:0 auto;padding:2.25rem 1rem}
    .copyright{opacity:.8;font-size:.9rem;margin-top:1rem}
  </style>
</head>
<body>
  <!-- NAV (kept) -->
  <div class="nav-wrap" id="top">
    <nav class="nav" aria-label="Primary">
      <a class="brand" href="/" aria-label="MiAmor Home">
        <img src="/img/miamor-logo.png" alt="MiAmor logo" width="36" height="36" loading="eager" decoding="async">
        <span>MiAmor</span>
      </a>
      <ul class="nav-menu">
        <li><a href="/" rel="follow">Home</a></li>
        <li><a href="/downloads.html" rel="follow">Download</a></li>
        <li><a href="/faq.html" rel="follow">FAQ</a></li>
        <li><a class="cta" href="/register.html" rel="follow">Register</a></li>
      </ul>
    </nav>
  </div>

  <!-- Header (kept) -->
  <header class="hero">
    <div class="wrap">
      <h1>MiAmor Blog</h1>
      <p>Setup guides, feature updates, marketplace tips, and safety best practices for Nigeria & beyond.</p>
    </div>
  </header>

  <!-- Search + filter (kept) -->
  <section class="controls" aria-label="Blog search and filter">
    <div class="search">
      <label for="q" class="sr-only" style="position:absolute;left:-9999px">Search posts</label>
      <input id="q" type="search" placeholder="Search posts…" aria-label="Search posts">
    </div>
    <select id="category" class="select" aria-label="Filter by category">
      <option value="">All categories</option>
      <option value="guides">Guides</option>
      <option value="updates">Updates</option>
      <option value="marketplace">Marketplace</option>
      <option value="safety">Safety</option>
    </select>
  </section>

  <!-- Dynamic Blog grid -->
  <main class="wrap" role="main">
    <section class="grid" id="posts" aria-live="polite" aria-busy="true">
      <!-- Cards will be injected here -->
    </section>
  </main>

  <!-- Footer (kept) -->
  <footer class="footer" role="contentinfo">
    <div class="wrap">
      <nav aria-label="Footer">
        <a href="/">Home</a> •
        <a href="/downloads.html">Download</a> •
        <a href="/packages.html">Packages</a> •
        <a href="/faq.html">FAQ</a> •
        <a href="/register.html">Contact</a>
      </nav>
      <p class="copyright">© MiAmor 2025 • All rights reserved</p>
    </div>
  </footer>

  <!-- Fetch posts from a folder via sitemap + extract meta -->
<script>
/* ========= MiAmor Blog Loader (diagnostic) ========= */

const POSTS_FOLDER = "/blog/";
const SITEMAP_URL  = `${location.origin}/sitemap.xml`;
const MAX_POSTS    = 100;
const CONCURRENCY  = 6;
const DEBUG        = true; // set false to silence overlay logs

const postsEl = document.getElementById('posts');
const q = document.getElementById('q');
const cat = document.getElementById('category');

// ---------- Debug helpers ----------
const log = (...a) => console.log("[Blog]", ...a);
const warn = (...a) => console.warn("[Blog]", ...a);
const err  = (...a) => console.error("[Blog]", ...a);

let dbgEl;
function dbg(msg, type = 'info') {
  const line = `[${new Date().toLocaleTimeString()}] ${msg}`;
  (type==='error'?err:type==='warn'?warn:log)(line);
  if (!DEBUG) return;
  if (!dbgEl) {
    dbgEl = document.createElement('div');
    dbgEl.style.cssText = 'position:fixed;bottom:10px;left:10px;max-width:420px;z-index:99999;background:#0f172acc;color:#e2e8f0;font:12px/1.4 system-ui,Segoe UI,Roboto,Arial;padding:10px 12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.35);white-space:pre-wrap;overflow:auto;max-height:42vh';
    const h = document.createElement('div');
    h.textContent = 'MiAmor Blog Debug';
    h.style.cssText = 'font-weight:700;margin-bottom:6px;color:#93c5fd';
    const close = document.createElement('button');
    close.textContent = '×';
    close.onclick = () => dbgEl.remove();
    close.style.cssText = 'position:absolute;right:8px;top:6px;background:#1e293b;color:#e2e8f0;border:0;border-radius:6px;width:24px;height:24px;cursor:pointer';
    dbgEl.appendChild(h); dbgEl.appendChild(close);
    const pre = document.createElement('div'); pre.id = 'dbg-lines'; dbgEl.appendChild(pre);
    document.body.appendChild(dbgEl);
  }
  const pre = dbgEl.querySelector('#dbg-lines');
  const p = document.createElement('div');
  p.textContent = line;
  p.style.color = type==='error'? '#fecaca' : type==='warn'? '#fde68a' : '#e2e8f0';
  pre.appendChild(p);
}

function assert(condition, message) {
  if (!condition) throw new Error(message);
}

// ---------- Utilities ----------
const escapeHTML = (str='') => String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
const fmtDate = (d) => { try { return new Date(d).toLocaleDateString(); } catch { return new Date().toLocaleDateString(); } };
function normalizeUrl(u) { try { return new URL(u, location.origin).href.replace('://www.', '://'); } catch { return u; } }
function urlContainsBlog(u) { try { const url = new URL(normalizeUrl(u)); const folder = POSTS_FOLDER.replace(/\/$/,''); return url.pathname.includes(`${folder}/`); } catch { return false; } }
function dateFromUrl(url='') { const m = url.match(/(\d{4})[-_/](\d{2})[-_/](\d{2})/); if (!m) return null; const [, y, mo, d] = m; return `${y}-${mo}-${d}T00:00:00Z`; }

async function fetchWithStep(url, stepName) {
  dbg(`➡️  Fetching: ${stepName} -> ${url}`);
  const res = await fetch(url, { credentials: 'same-origin' });
  dbg(`⬅️  ${stepName} status: ${res.status}`);
  assert(res.ok, `${stepName} failed with status ${res.status}`);
  return res;
}

async function fetchDoc(url) {
  const res = await fetchWithStep(url, 'Post HTML');
  const html = await res.text();
  const doc = new DOMParser().parseFromString(html, 'text/html');
  // Basic sanity: must have <title> or meta title
  const hasTitle = !!(doc.title || doc.querySelector('meta[name="title"]'));
  assert(hasTitle, `Missing <title> in ${url}`);
  return doc;
}

function pickAttr(doc, selector, attrList=['content','href','src']) {
  const el = doc.querySelector(selector);
  if (!el) return '';
  for (const a of attrList) { const v = el.getAttribute?.(a); if (v) return v; }
  return el.textContent?.trim() || '';
}

function extractPost(doc, url) {
  const title = pickAttr(doc, 'meta[name="title"]') || (doc.title || '').trim() || 'Untitled Post';
  let description = pickAttr(doc, 'meta[name="description"]');
  let image = pickAttr(doc, 'meta[property="og:image"]') || pickAttr(doc, 'meta[name="twitter:image"]');
  if (!image) {
    const featured = doc.querySelector('img[data-featured], img[alt*="featured" i], article img, main img, img');
    image = featured ? (featured.getAttribute('src') || '') : '';
  }
  if (image && !/^https?:\/\//i.test(image)) image = new URL(image, url).href;

  const dateMeta = pickAttr(doc, 'meta[property="article:published_time"]') || pickAttr(doc, 'meta[name="date"]') || pickAttr(doc, 'meta[name="pubdate"]') || (doc.querySelector('time[datetime]')?.getAttribute('datetime') || '') || dateFromUrl(url) || new Date().toISOString();
  const category = (pickAttr(doc, 'meta[name="category"]') || pickAttr(doc, 'meta[property="article:section"]') || '').toLowerCase().trim();

  if (!description) {
    const p = doc.querySelector('main p, article p, .content p, p');
    description = p ? p.textContent.trim() : '';
  }
  if (description.length > 200) description = description.slice(0, 197) + '…';

  return { url, title, description, image: image || (location.origin + '/img/og-cover.jpg'), publishedAt: dateMeta, category };
}

function cardHTML(post) {
  const title = escapeHTML(post.title);
  const desc  = escapeHTML(post.description || '');
  const img   = escapeHTML(post.image || '/img/og-cover.jpg');
  const category = post.category ? escapeHTML(post.category) : '';
  const dateStr  = fmtDate(post.publishedAt);
  return `
    <article class="card" ${category ? `data-cat="${category}"` : ''}>
      <img src="${img}" alt="${title}" loading="lazy" decoding="async">
      <h2>${title}</h2>
      <div class="meta">${dateStr}${category ? ` • ${category}` : ''}</div>
      ${desc ? `<p class="excerpt">${desc}</p>` : ''}
      <a class="btn" href="${post.url}">Read more</a>
    </article>
  `;
}

function injectSchema(posts) {
  const graph = posts.map(p => ({
    "@type": "BlogPosting",
    "headline": p.title,
    "description": p.description,
    "image": p.image,
    "author": {"@type":"Organization","name":"MiAmor"},
    "publisher": {"@type":"Organization","name":"MiAmor","logo":{"@type":"ImageObject","url": location.origin + "/img/miamor-logo.png"}},
    "mainEntityOfPage":{"@type":"WebPage","@id": p.url},
    "datePublished": new Date(p.publishedAt).toISOString(),
    "dateModified": new Date(p.publishedAt).toISOString(),
    "url": p.url
  }));
  const el = document.createElement('script');
  el.type = 'application/ld+json';
  el.textContent = JSON.stringify({"@context":"https://schema.org","@graph":graph});
  document.head.appendChild(el);
}

function render(posts) {
  posts.sort((a,b) => new Date(b.publishedAt) - new Date(a.publishedAt));
  postsEl.innerHTML = posts.map(cardHTML).join('');
  postsEl.setAttribute('aria-busy','false');
  injectSchema(posts);
  filter();
  dbg(`✅ Rendered ${posts.length} post(s).`);
}

function filter() {
  const term = (q.value || '').toLowerCase();
  const c = (cat.value || '').toLowerCase();
  const cards = postsEl.querySelectorAll('.card');
  cards.forEach(card => {
    const matchesTerm = card.textContent.toLowerCase().includes(term);
    const matchesCat = !c || (card.getAttribute('data-cat') === c);
    card.style.display = (matchesTerm && matchesCat) ? '' : 'none';
  });
}
q.addEventListener('input', filter);
cat.addEventListener('change', filter);

async function urlsFromSitemap() {
  dbg('Step 1: Checking navigator.onLine = ' + navigator.onLine);
  const res = await fetchWithStep(SITEMAP_URL, 'Sitemap');
  const xml = await res.text();
  const doc = new DOMParser().parseFromString(xml, 'application/xml');
  const locs = [...doc.querySelectorAll('url > loc')].map(n => n.textContent.trim());
  dbg('Step 2: URLs in sitemap: ' + locs.length);

  const urls = locs
    .filter(u => /\.html?(\?.*)?$/i.test(u))
    .filter(u => urlContainsBlog(u))
    .filter(u => !/\/blog\.html$/i.test(u))
    .slice(0, MAX_POSTS)
    .map(normalizeUrl);

  dbg('Step 3: Blog URLs after filter: ' + urls.length + '\n' + urls.join('\n'));
  return urls;
}

async function mapLimit(items, limit, worker) {
  const out = [];
  let i = 0;
  async function run() {
    while (i < items.length) {
      const idx = i++;
      try { out[idx] = await worker(items[idx], idx); }
      catch (e) { dbg(`⚠️ Worker failed for ${items[idx]}: ${e.message}`, 'warn'); out[idx] = null; }
    }
  }
  await Promise.all(Array.from({length: Math.min(limit, items.length)}, run));
  return out.filter(Boolean);
}

(async function init(){
  try {
    dbg('=== INIT START ===');
    const urls = await urlsFromSitemap();

    if (!urls.length) {
      dbg('No /blog/ URLs in sitemap → trying /blog/index.json', 'warn');
      const mres = await fetchWithStep(POSTS_FOLDER.replace(/\/$/, '') + '/index.json', 'Manifest');
      const list = await mres.json();
      assert(Array.isArray(list) && list.length, 'Manifest is empty.');
      dbg('Loaded manifest with ' + list.length + ' item(s).');
      render(list);
      return;
    }

    dbg('Step 4: Fetching each post HTML…');
    const posts = await mapLimit(urls, CONCURRENCY, async (url) => {
      const doc = await fetchDoc(url);
      const p = extractPost(doc, url);
      dbg(`✔ Extracted: ${p.title}`);
      return p;
    });

    assert(posts.length, 'No posts extracted from discovered URLs.');
    render(posts);
    dbg('=== INIT DONE ===');
  } catch (e) {
    dbg('❌ FATAL: ' + e.message, 'error');
    postsEl.setAttribute('aria-busy','false');
    postsEl.innerHTML = "<p style='color:#b91c1c;background:#fee2e2;padding:.75rem;border-radius:.5rem'>Error loading blog posts.</p>";
  }

  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => { navigator.serviceWorker.register('/sw.js').catch(()=>{}); });
  }
})();
</script>
